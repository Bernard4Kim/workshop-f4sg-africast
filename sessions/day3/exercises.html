<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.47">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-10-25">

<title>Exercises – F4SG: Africast</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../..//images/fable.svg" rel="icon" type="image/svg+xml">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<meta name="twitter:title" content="Exercises – F4SG: Africast">
<meta name="twitter:description" content="Check with your mentor on Slack">
<meta name="twitter:image" content="https://workshop.f4sg.org/africast/images/twitter-card.png">
<meta name="twitter:creator" content="@mitchoharawild">
<meta name="twitter:image-height" content="654">
<meta name="twitter:image-width" content="1250">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">F4SG: Africast</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sessions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sessions">    
        <li>
    <a class="dropdown-item" href="../../sessions/day1/basics.html">
 <span class="dropdown-text">Basics of time series and data structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day1/graphics.html">
 <span class="dropdown-text">Time series patterns and basic graphics</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day2/adjustments.html">
 <span class="dropdown-text">Recap day 1, transforming / adjusting time series</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day2/features.html">
 <span class="dropdown-text">Computing and visualizing features (features)</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day3/forecasting.html">
 <span class="dropdown-text">Basic modeling / forecasting</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day3/regressors.html">
 <span class="dropdown-text">Forecasting with regression, how to represent temporal structure with regressors</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day4/ets.html">
 <span class="dropdown-text">ETS, building on recap of temporal regressors.</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day4/arima.html">
 <span class="dropdown-text">ARIMA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day5/accuracy.html">
 <span class="dropdown-text">Recap forecasting methods, basic training and test accuracy</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../sessions/day5/diagnostics.html">
 <span class="dropdown-text">Advanced performance evaluation: residual diagnostics and cross validation</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-downloads" role="link" data-bs-toggle="dropdown" aria-expanded="false">
      <i class="bi bi-download" role="img">
</i> 
 <span class="menu-text">Downloads</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-downloads">    
        <li>
    <a class="dropdown-item" href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/archive/refs/heads/master.zip">
 <span class="dropdown-text">Everything</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../slides.zip">
 <span class="dropdown-text">Slides</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../exercises.zip">
 <span class="dropdown-text">Lab sessions</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../license.html"> <i class="bi bi-file-certificate" role="img">
</i> 
<span class="menu-text">License</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#learn" id="toc-learn" class="nav-link active" data-scroll-target="#learn">Learn</a>
  <ul class="collapse">
  <li><a href="#basic-forecasting-models" id="toc-basic-forecasting-models" class="nav-link" data-scroll-target="#basic-forecasting-models">Basic forecasting models</a></li>
  <li><a href="#regression-forecasting" id="toc-regression-forecasting" class="nav-link" data-scroll-target="#regression-forecasting">Regression forecasting</a></li>
  </ul></li>
  <li><a href="#apply" id="toc-apply" class="nav-link" data-scroll-target="#apply">Apply</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/edit/main/sessions/day3/exercises.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exercises</h1>
<p class="subtitle lead"><span class="code">Check with your mentor on Slack</span></p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Date</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 25, 2023</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="learn" class="level1">
<h1>Learn</h1>
<p>Forecasting involves modelling the historical patterns in the data and then projecting them into the future. Some models use time information alone, while others use additional information. Importantly, forecasting models assume the patterns in the past will continue into the future.</p>
<section id="basic-forecasting-models" class="level2">
<h2 class="anchored" data-anchor-id="basic-forecasting-models">Basic forecasting models</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are four basic forecasting models which are commonly used as ‘benchmarks’ for other more sophisticated methods. These are:</p>
<ul>
<li><code>MEAN()</code> - the average of the data (mean)</li>
<li><code>NAIVE()</code> - the most recent value (naive)</li>
<li><code>SNAIVE()</code> - the most recent value from the same season (seasonal naive)</li>
<li><code>RW(y ~ drift())</code> - a straight between the first and last values (random walk with drift)</li>
</ul>
</div>
</div>
<p>Despite their simplicity, these models work well for many time series and can be difficult to improve upon!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Fit for purpose
</div>
</div>
<div class="callout-body-container callout-body">
<p>Each of these methods work for a specific pattern that might exist in the data.</p>
<ul>
<li><code>MEAN()</code> - no pattern</li>
<li><code>NAIVE()</code> - unit root process</li>
<li><code>SNAIVE()</code> - seasonality</li>
<li><code>RW(y ~ drift())</code> - simple trend</li>
</ul>
</div>
</div>
<p>The models used for forecasting should match the patterns identified when plotting the time series.</p>
<p>Let’s look at the population of the United Kingdon</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This time series shows an upward trend and no seasonality, so the random walk with drift is the most appropriate method from the four simple benchmark models above.</p>
<p>Similar to how we estimated an STL model, we use <code>model()</code> to train a model specification (<code>RW(Population ~ drift())</code>) to the data.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 2
# Key:     Country [1]
  Country        `RW(Population ~ drift())`
  &lt;fct&gt;                             &lt;model&gt;
1 United Kingdom              &lt;RW w/ drift&gt;</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
The model formula
</div>
</div>
<div class="callout-body-container callout-body">
<p>Models in <code>{fable}</code> are specified using a model formula (<code>lhs ~ rhs</code>).</p>
<p>On the left of <code>~</code> we specify the response variable (what we want to forecast) along with any transformations we’ve made to simplify the patterns.</p>
<p>On the right of <code>~</code> we specify the model specials, which describe the patterns in the data we will use when forecasting. This is model specific, so check the help file of the model with <code>?RW</code> for more information!</p>
</div>
</div>
<p>To produce a forecast from this model we use the <code>forecast()</code> function, and specify how far ahead we wish to forecast with the <code>h</code> (horizon) argument. The <code>h</code> argument can be a number for how many steps to forecast, or plain text describing the duration.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A fable: 10 x 5 [1Y]
# Key:     Country, .model [1]
   Country        .model                    Year
   &lt;fct&gt;          &lt;chr&gt;                    &lt;dbl&gt;
 1 United Kingdom RW(Population ~ drift())  2018
 2 United Kingdom RW(Population ~ drift())  2019
 3 United Kingdom RW(Population ~ drift())  2020
 4 United Kingdom RW(Population ~ drift())  2021
 5 United Kingdom RW(Population ~ drift())  2022
 6 United Kingdom RW(Population ~ drift())  2023
 7 United Kingdom RW(Population ~ drift())  2024
 8 United Kingdom RW(Population ~ drift())  2025
 9 United Kingdom RW(Population ~ drift())  2026
10 United Kingdom RW(Population ~ drift())  2027
# ℹ 2 more variables: Population &lt;dist&gt;, .mean &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Here we have a <code>fable</code> - a forecasting table. It looks like a tsibble, but the response variable <code>Population</code> contains entire distributions of possible future values at each step in the future. We can look at these forecasts using the <code>autoplot()</code> function.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Context is key
</div>
</div>
<div class="callout-body-container callout-body">
<p>When plotting the forecasts it is useful to also show some historical data. This helps us see if the forecasts seem reasonable. To add historical data, add the original dataset to the first argument of the <code>autoplot()</code> function.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Not bad. These forecasts are trended upward but likely a bit flat. Verify that this forecast simply continues the line that connects the first and last observations. This trend is known as a global trend (or ‘drift’ for this model), but we can see the trend changes over time for this data. Later we’ll see more advanced models which can handle changing (local) trends.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Choose a country from the <code>global_economy</code> dataset and select the most suitable benchmark method. Produce forecasts of population for 15 years into the future, and comment on the suitability of these forecasts based on a plot of them and the data.</p>
</div>
</div>
<p>Next let’s forecast the household wealth of the four countries in the <code>hh_budget</code> dataset.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>These time series all show some trend that changes over time. There isn’t any seasonality here, so the random walk with drift model would also work well here. The <code>model()</code> function will apply the specified model to all time series in the data, so the code looks very similar to above.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 4 x 2
# Key:     Country [4]
  Country   `RW(Wealth ~ drift())`
  &lt;chr&gt;                    &lt;model&gt;
1 Australia          &lt;RW w/ drift&gt;
2 Canada             &lt;RW w/ drift&gt;
3 Japan              &lt;RW w/ drift&gt;
4 USA                &lt;RW w/ drift&gt;</code></pre>
</div>
</div>
<p>Here we have four random walk with drift models that have been trained on the household wealth from each of the four countries in the dataset. We can forecast from all four models using the <code>forecast()</code> function, and then plot them with <code>autoplot()</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Comment on the suitability of these forecasts.</p>
</div>
</div>
<p>Let’s try to forecast the future turnover of Australia’s print media industry. Recall this plot from the previous exercises.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Most appropriate model
</div>
</div>
<div class="callout-body-container callout-body">
<p>Which model would be most appropriate for this dataset? In this case none of the methods can capture all of the patterns here.</p>
<p>This dataset has a strong seasonal pattern, which a trend that changes over time.</p>
<p>The random walk with drift can handle trends, but in this case the changing trend does not match the global trend that this model will use.</p>
<p>The seasonal naive model can handle the seasonality, but it is unable to handle the trend too.</p>
<p>None of the four basic models can capture all of the patterns in this dataset, but the seasonal naive model is most appropriate since it can handle some of the patterns in the data.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>As expected, the forecasts have the same seasonal pattern as the recent data but don’t have any trend. We’ll need more advanced models to capture both.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Multiple models
</div>
</div>
<div class="callout-body-container callout-body">
<p>We can compare the forecasts from multiple models by specifying several models in the <code>model()</code> function.</p>
</div>
</div>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A mable: 1 x 2
    snaive       rwdrift
   &lt;model&gt;       &lt;model&gt;
1 &lt;SNAIVE&gt; &lt;RW w/ drift&gt;</code></pre>
</div>
</div>
<p>Here we have a column for each of the models that we have specified. Forecasts from both of these models can be created using <code>forecast()</code>, and compared visually with <code>autoplot()</code>.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The seasonal naive method looks much better than the random walk with drift. The forecast intervals of the drift method are very wide, and the forecasts are trended slightly upward despite the recent turnover trending downward.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Produce forecasts from two suitable models for the total Australian retail turnover, and select the most appropriate one based on visual inspection of the forecast plot.</p>
</div>
</div>
</section>
<section id="regression-forecasting" class="level2">
<h2 class="anchored" data-anchor-id="regression-forecasting">Regression forecasting</h2>
<p>Linear regression can also be used to forecast time series, and by carefully constructing predictors we can use it to capture trends, seasonality, and relationships with other variables all at once.</p>
<p>A regression model is estimated using <code>TSLM()</code>, and there are some useful model specials which help create predictors for trend and seasonality.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Regression specials
</div>
</div>
<div class="callout-body-container callout-body">
<p>A linear trend can be created with the <code>trend()</code> special. You can also specify changepoints in the trend by describing the ‘knot’ location(s) with <code>trend(knots = yearmonth("2010 Jan"))</code>, which will create different trends before and after these knot(s).</p>
<p>Seasonal patterns can be modelled with the <code>season()</code> special, which will create dummy variables for each time point in the season. Don’t forget to transform your data first, since the <code>season()</code> special assumes all seasons have the same size and shape.</p>
</div>
</div>
<p>Let’s try to create a regression model for the Australian print media turnover. I’ve used a <code>log()</code> transformation to regularise the variance, but a box-cox transformation would work even better.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Model misspecification
</div>
</div>
<div class="callout-body-container callout-body">
<p>Those forecasts look bad! The seasonality matches the right shape, but the trend is completely wrong and the forecasts are very far from the most recent data. We need to improve our trend parameter with some knots.</p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Much better! Adding a knot just as the trend changes in 2011 allows the forecasts to follow the more recent trend.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Your turn!
</div>
</div>
<div class="callout-body-container callout-body">
<p>Produce suitable forecasts from a regression model for the total Australian retail turnover that captures both the trend and seasonality in the data. Compare these forecasts with the two basic models produced earlier, which model produces the most reasonable forecasts and why?</p>
</div>
</div>
<p>The coefficients from this model can be obtained with the <code>tidy()</code> function, <code>glance()</code> provides a summary of the model and <code>augment()</code> returns a tsibble of the model’s predictions and errors on the training data. These functions are useful for better understanding the model that was used to produce the forecasts.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 6
   .model term                            estimate std.error statistic   p.value
   &lt;chr&gt;  &lt;chr&gt;                              &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 lm     "(Intercept)"                    5.13    0.0154      334.    0        
 2 lm     "trend(knots = yearmonth(\"201…  0.00248 0.0000396    62.6   3.45e-217
 3 lm     "trend(knots = yearmonth(\"201… -0.00843 0.000215    -39.3   7.68e-144
 4 lm     "season()year2"                 -0.00887 0.0189       -0.469 6.39e-  1
 5 lm     "season()year3"                  0.0262  0.0189        1.39  1.66e-  1
 6 lm     "season()year4"                 -0.0830  0.0188       -4.42  1.24e-  5
 7 lm     "season()year5"                 -0.0278  0.0188       -1.48  1.40e-  1
 8 lm     "season()year6"                 -0.0864  0.0188       -4.60  5.52e-  6
 9 lm     "season()year7"                 -0.0220  0.0188       -1.17  2.42e-  1
10 lm     "season()year8"                  0.00197 0.0188        0.105 9.17e-  1
11 lm     "season()year9"                 -0.0450  0.0188       -2.39  1.71e-  2
12 lm     "season()year10"                -0.0257  0.0188       -1.37  1.72e-  1
13 lm     "season()year11"                 0.0167  0.0188        0.888 3.75e-  1
14 lm     "season()year12"                 0.274   0.0188       14.6   1.75e- 39</code></pre>
</div>
</div>
<p>The initial trend is upward (+0.002477/month), but after 2011 the trend decreases (0.002477-0.008432=-0.005955/month). The seasonality peaks in December, which is +0.27426 more than January.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 15
  .model r_squared adj_r_squared  sigma2 statistic   p_value    df log_lik
  &lt;chr&gt;      &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
1 lm         0.913         0.910 0.00643      345. 6.25e-217    14    494.
# ℹ 7 more variables: AIC &lt;dbl&gt;, AICc &lt;dbl&gt;, BIC &lt;dbl&gt;, CV &lt;dbl&gt;,
#   deviance &lt;dbl&gt;, df.residual &lt;int&gt;, rank &lt;int&gt;</code></pre>
</div>
</div>
<p>The r-squared of this model is high, at 0.91.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The model matches the historical data quite well, but the small changes in trend before 2010 can be improved upon.</p>
<p>Regression models can also use additional information from other variables in the data. Let’s consider the household budget again.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 88 x 8 [1Y]
# Key:       Country [4]
   Country    Year  Debt     DI Expenditure Savings Wealth Unemployment
   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;
 1 Australia  1995  95.7 3.72          3.40   5.24    315.         8.47
 2 Australia  1996  99.5 3.98          2.97   6.47    315.         8.51
 3 Australia  1997 108.  2.52          4.95   3.74    323.         8.36
 4 Australia  1998 115.  4.02          5.73   1.29    339.         7.68
 5 Australia  1999 121.  3.84          4.26   0.638   354.         6.87
 6 Australia  2000 126.  3.77          3.18   1.99    350.         6.29
 7 Australia  2001 132.  4.36          3.10   3.24    348.         6.74
 8 Australia  2002 149.  0.0218        4.03  -1.15    349.         6.37
 9 Australia  2003 159.  6.06          5.04  -0.413   360.         5.93
10 Australia  2004 170.  5.53          4.54   0.657   379.         5.40
# ℹ 78 more rows</code></pre>
</div>
</div>
<p>Here we have lots of information about the households in these countries, including their debt, disposable income, savings, and more. We can use this information when modelling household wealth.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This seems to produce a better model than the random walk with drift, as it can better anticipate the drops in wealth before they happen. However there’s a catch, when we come to forecasting we need to know the future…</p>
<div class="cell">
<div class="cell-output cell-output-error">
<pre><code>Error in `mutate()`:
ℹ In argument: `TSLM(Wealth ~ trend() + Expenditure) = (function
  (object, ...) ...`.
Caused by error in `value[[3L]]()`:
! object 'Expenditure' not found
  Unable to compute required variables from provided `new_data`.
  Does your model require extra variables to produce forecasts?</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Extra information
</div>
</div>
<div class="callout-body-container callout-body">
<blockquote class="blockquote">
<p><code>object 'Expenditure' not found</code>, …, Does your model require extra variables to produce forecasts?</p>
</blockquote>
<p>To produce forecasts from models that use extra information for transforming or modelling the data, you will need to provide the future values of these variables when forecasting! Often these are just as difficult to forecast as your response variable!</p>
<p>However if you cannot forecast these variables, the model can still be useful for scenario analysis.</p>
</div>
</div>
<p>The future values of extra variables used in the model must be provided to the <code>forecast(new_data = ???)</code> argument. The <code>new_data</code> argument is for a tsibble containing the future points in time, and values of other variables, needed to produce the forecasts. We can produce a tsibble with the future time points easily using the <code>new_data()</code> function.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 20 x 2 [1Y]
# Key:       Country [4]
   Country    Year
   &lt;chr&gt;     &lt;dbl&gt;
 1 Australia  2017
 2 Australia  2018
 3 Australia  2019
 4 Australia  2020
 5 Australia  2021
 6 Canada     2017
 7 Canada     2018
 8 Canada     2019
 9 Canada     2020
10 Canada     2021
11 Japan      2017
12 Japan      2018
13 Japan      2019
14 Japan      2020
15 Japan      2021
16 USA        2017
17 USA        2018
18 USA        2019
19 USA        2020
20 USA        2021</code></pre>
</div>
</div>
<p>Adding the future values for <code>Expenditure</code> is tricky though - we can forecast it or set up scenarios. For simplicity we’ll just see what happens if the expenditure has a growth rate of 3% for all countries over the 5 years.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tsibble: 20 x 3 [1Y]
# Key:       Country [4]
   Country    Year Expenditure
   &lt;chr&gt;     &lt;dbl&gt;       &lt;dbl&gt;
 1 Australia  2017           3
 2 Australia  2018           3
 3 Australia  2019           3
 4 Australia  2020           3
 5 Australia  2021           3
 6 Canada     2017           3
 7 Canada     2018           3
 8 Canada     2019           3
 9 Canada     2020           3
10 Canada     2021           3
11 Japan      2017           3
12 Japan      2018           3
13 Japan      2019           3
14 Japan      2020           3
15 Japan      2021           3
16 USA        2017           3
17 USA        2018           3
18 USA        2019           3
19 USA        2020           3
20 USA        2021           3</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="exercises_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>A better estimate of <code>Expenditure</code> will produce better forecasts.</p>
<!-- You can also model seasonal patterns with `fourier()`, which uses fourier terms to estimate the seasonality. This is useful if you have non-integer -->
</section>
</section>
<section id="apply" class="level1">
<h1>Apply</h1>
<p>In this exercise, we first use simple models to produce forecasts of future administered vaccine doses for the next 12 months. Following that, we use regression models to produce such a forecast.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Basic of modelling/forecating
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Specify and train three simple models including total average, naive and seasonal naive on administered vaccine doses.</p></li>
<li><p>Examine the model table (<code>mable</code>) object and describe what each column and row represent.</p></li>
<li><p>Use <code>report()</code>, <code>tidy()</code>, <code>glance()</code> and <code>augment()</code> to explore the trained model’s output.</p></li>
<li><p>Produce forecasts for 12 months ahead including both point forecast and forecast distribution.</p></li>
<li><p>Examine the forecast table (<code>fable</code>) object and explain what each column and row represent.</p></li>
<li><p>Visualize the point forecasts alongside past values, as well as prediction interval for <span class="math inline">\(90%\)</span> coverage.</p></li>
<li><p>Extract prediction intervals for <span class="math inline">\(90%\)</span> coverage.</p></li>
<li><p>Produce probabilistic forecast using bootstrapping instead of assuming normal distribution. Generate 1000 possible future.</p></li>
</ol>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Forecating using regression
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Examine the association between <code>dose_adminstrated</code> and predictors</p>
<ul>
<li>Assess the association between <code>dose_adminstrated</code> and <code>population_under1</code></li>
<li>Assess the association between <code>dose_adminstrated</code> and <code>strike</code></li>
<li>Examine the association between leading predictors of <code>population_under1</code> and <code>dose_adminstrated</code></li>
</ul></li>
<li><p>Specify and train the four different regression models with the following terms:</p>
<ul>
<li>trensd and seasonality</li>
<li>trensd, seasonality, and population_under1</li>
<li>trensd, seasonality, population_under1, and strike</li>
</ul></li>
<li><p>Examine trained model output using <code>report()</code>, <code>tidy()</code>, and <code>glance()</code> and <code>augment()</code></p></li>
<li><p>Produce forecast</p>
<ul>
<li>Use <code>new_data()</code> to generate future months corresponding to forecast horizon</li>
<li>Add future values for the strike</li>
<li>Add future values for the population_under1</li>
<li>Generate forecasts for future periods</li>
</ul></li>
<li><p>Visualize forecasts</p></li>
</ol>
</div>
</div>


</section>

</main> <!-- /main -->
<!-- plausible --> 
<script defer="" data-domain="workshop.f4sg.org" src="https://track.mitchelloharawild.com/js/plausible.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/workshop\.f4sg\.org\/africast");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>This page is built with ❤️ and <a href="https://quarto.org/">Quarto</a>.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/edit/main/sessions/day3/exercises.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/Forecasting-for-Social-Good/workshop-f4sg-africa/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>© Copyright 2023, <a href="https://www.f4sg.org/">F4SG</a></p>
</div>
  </div>
</footer>




</body></html>